"use strict";(self.webpackChunkcodetenshu=self.webpackChunkcodetenshu||[]).push([[8172],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>D});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},p=Object.keys(e);for(a=0;a<p.length;a++)t=p[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(a=0;a<p.length;a++)t=p[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),s=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},d=function(e){var n=s(e.components);return a.createElement(l.Provider,{value:n},e.children)},u="mdxType",A={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},C=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,p=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=s(t),C=r,D=u["".concat(l,".").concat(C)]||u[C]||A[C]||p;return t?a.createElement(D,i(i({ref:n},d),{},{components:t})):a.createElement(D,i({ref:n},d))}));function D(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var p=t.length,i=new Array(p);i[0]=C;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o[u]="string"==typeof e?e:r,i[1]=o;for(var s=2;s<p;s++)i[s]=t[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}C.displayName="MDXCreateElement"},243:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>p,metadata:()=>o,toc:()=>s});var a=t(7462),r=(t(7294),t(3905));const p={sidebar_position:11},i=void 0,o={unversionedId:"finance-bank-api/Day10 - \u5b89\u5168\u7121\u865e\u5f8c\uff0c\u958b\u59cb\u5efa\u7acb\u8a02\u55ae ATM\u865b\u64ec\u5e33\u865f\u7bc7 (2)",id:"finance-bank-api/Day10 - \u5b89\u5168\u7121\u865e\u5f8c\uff0c\u958b\u59cb\u5efa\u7acb\u8a02\u55ae ATM\u865b\u64ec\u5e33\u865f\u7bc7 (2)",title:"Day10 - \u5b89\u5168\u7121\u865e\u5f8c\uff0c\u958b\u59cb\u5efa\u7acb\u8a02\u55ae ATM\u865b\u64ec\u5e33\u865f\u7bc7 (2)",description:"\u76ee\u524d\u7684\u60c5\u5883\u662f\uff0c\u6211\u5011\u7684\u9867\u5ba2\u5df2\u5728\u96fb\u5546\u5e73\u53f0\u628a\u5546\u54c1\u653e\u5165\u8cfc\u7269\u8eca\uff0c\u800c\u4e14\u6700\u5f8c\u5728\u5931\u5fc3\u760b\u52a0\u4e0a\u624b\u6ed1\u7684\u60c5\u5883\u4e0b\uff0c\u6c7a\u5b9a\u8981\u8cfc\u8cb7\uff0c\u56e0\u6b64\u9019\u4efd\u8a02\u55ae\u9700\u8981\u5148\u884c\u6210\u7acb\uff0c\u5f8c\u9762\u7684\u968e\u6bb5\u624d\u662f\u5c07\u6b64\u8a02\u55ae\u5be6\u969b\u4ed8\u6b3e\u72c0\u614b\u4e32\u8d77\u4f86\u3002",source:"@site/docs/finance-bank-api/Day10 - \u5b89\u5168\u7121\u865e\u5f8c\uff0c\u958b\u59cb\u5efa\u7acb\u8a02\u55ae ATM\u865b\u64ec\u5e33\u865f\u7bc7 (2).md",sourceDirName:"finance-bank-api",slug:"/finance-bank-api/Day10 - \u5b89\u5168\u7121\u865e\u5f8c\uff0c\u958b\u59cb\u5efa\u7acb\u8a02\u55ae ATM\u865b\u64ec\u5e33\u865f\u7bc7 (2)",permalink:"/docs/finance-bank-api/Day10 - \u5b89\u5168\u7121\u865e\u5f8c\uff0c\u958b\u59cb\u5efa\u7acb\u8a02\u55ae ATM\u865b\u64ec\u5e33\u865f\u7bc7 (2)",draft:!1,tags:[],version:"current",sidebarPosition:11,frontMatter:{sidebar_position:11},sidebar:"tutorialSidebar",previous:{title:"Day09 - \u5b89\u5168\u7121\u865e\u5f8c\uff0c\u958b\u59cb\u5efa\u7acb\u8a02\u55ae ATM\u865b\u64ec\u5e33\u865f\u7bc7 (1)",permalink:"/docs/finance-bank-api/Day09 - \u5b89\u5168\u7121\u865e\u5f8c\uff0c\u958b\u59cb\u5efa\u7acb\u8a02\u55ae ATM\u865b\u64ec\u5e33\u865f\u7bc7 (1)"},next:{title:"Day11 - \u79ae\u5c1a\u5f80\u4f86\uff0c\u6211\u5011\u4e5f\u9700\u8981\u89e3\u958bAPI\u56de\u50b3\u7684\u5bc6\u79d8",permalink:"/docs/finance-bank-api/Day11 - \u79ae\u5c1a\u5f80\u4f86\uff0c\u6211\u5011\u4e5f\u9700\u8981\u89e3\u958bAPI\u56de\u50b3\u7684\u5bc6\u79d8"}},l={},s=[{value:"\u7a0b\u5f0f\u8aaa\u660e",id:"\u7a0b\u5f0f\u8aaa\u660e",level:5},{value:"\u7a0b\u5f0f\u8aaa\u660e",id:"\u7a0b\u5f0f\u8aaa\u660e-1",level:5},{value:"\u7a0b\u5f0f\u8aaa\u660e",id:"\u7a0b\u5f0f\u8aaa\u660e-2",level:5},{value:"\u7a0b\u5f0f\u8aaa\u660e",id:"\u7a0b\u5f0f\u8aaa\u660e-3",level:5},{value:"\u7a0b\u5f0f\u8aaa\u660e",id:"\u7a0b\u5f0f\u8aaa\u660e-4",level:5},{value:"\u7a0b\u5f0f\u8aaa\u660e",id:"\u7a0b\u5f0f\u8aaa\u660e-5",level:5},{value:"\u6240\u4ee5\uff0c\u6210\u529f\u4e86\u55ce\uff1f",id:"\u6240\u4ee5\u6210\u529f\u4e86\u55ce",level:3}],d={toc:s};function u(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\u76ee\u524d\u7684\u60c5\u5883\u662f\uff0c\u6211\u5011\u7684\u9867\u5ba2\u5df2\u5728\u96fb\u5546\u5e73\u53f0\u628a\u5546\u54c1\u653e\u5165\u8cfc\u7269\u8eca\uff0c\u800c\u4e14\u6700\u5f8c\u5728",(0,r.kt)("del",{parentName:"p"},"\u5931\u5fc3\u760b\u52a0\u4e0a\u624b\u6ed1"),"\u7684\u60c5\u5883\u4e0b\uff0c\u6c7a\u5b9a\u8981\u8cfc\u8cb7\uff0c\u56e0\u6b64\u9019\u4efd\u8a02\u55ae\u9700\u8981\u5148\u884c\u6210\u7acb\uff0c\u5f8c\u9762\u7684\u968e\u6bb5\u624d\u662f\u5c07\u6b64\u8a02\u55ae\u5be6\u969b\u4ed8\u6b3e\u72c0\u614b\u4e32\u8d77\u4f86\u3002"),(0,r.kt)("p",null,"\u6240\u4ee5\u6211\u5011\u9700\u8981\u4e00\u500b\u8a02\u55ae\u7de8\u865f\u7684\u7522\u751f\u5668\uff0c\u9019\u88e1\u5728\u6c38\u8c50API\u6e2c\u8a66\u74b0\u5883\u4e0b\uff0c\u70ba\u4e86\u4fbf\u65bc\u958b\u767c\u8005\u6e2c\u8a66\u56e0\u6b64\u6709\u4e00\u500b\u5c0f\u898f\u5247\uff0c\u539f\u6587\u5982\u4e0b\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5efa\u7acb\u300c\u6e2c\u8a66\u865b\u64ec\u5e33\u865f\u300d\u8a02\u55ae\u6210\u529f\u5f8c\uff0c\u7cfb\u7d71\u6bcf\u96945\u5206\u9418\u6703\u81ea\u52d5\u6a21\u64ec\u6d88\u8cbb\u8005\u4ed8\u6b3e\u5b8c\u6210\uff1b\u82e5\u8a02\u55ae\u7de8\u865f(OrderNo)\u5c3e\u6578\u70ba9\uff0c\u7cfb\u7d71\u5373\u4e0d\u9032\u884c\u4ed8\u6b3e\u52d5\u4f5c\uff0c\u53ef\u7528\u65bc\u6e2c\u8a66\u300c\u4ed8\u6b3e\u5e33\u865f\u903e\u671f\u300d\u60c5\u5883\uff0c\u8acb\u7279\u5225\u6ce8\u610f\u60a8\u7684\u8a02\u55ae\u7de8\u865f\u5c3e\u6578\u3002")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5c3e\u6578",(0,r.kt)("strong",{parentName:"li"},"\u662f9"),"\u7684\u8a02\u55ae\uff0c\u6703\u6a21\u64ec\u9867\u5ba2\u7522\u751f\u5b8c\u5f8c\u4e0d\u6703\u53bb\u7528\u9019\u500b\u865b\u64ec\u5e33\u6236\u8f49\u5e33"),(0,r.kt)("li",{parentName:"ul"},"\u5c3e\u6578",(0,r.kt)("strong",{parentName:"li"},"\u975e9"),"\u7684\u8a02\u55ae\uff0c\u6703\u6a21\u64ec\u9867\u5ba25\u5206\u9418\u4e4b\u5f8c\u6703\u4ed8\u6b3e")),(0,r.kt)("p",null,"\u800c\u6211\u5011\u7684\u8a02\u55ae\u5957\u7528\u4e00\u500b\u81ea\u8a02\u7684\u898f\u5247\uff1a\n",(0,r.kt)("inlineCode",{parentName:"p"},"A"),"+",(0,r.kt)("inlineCode",{parentName:"p"},"\u5e74\u4efd"),"+",(0,r.kt)("inlineCode",{parentName:"p"},"\u6708\u4efd"),"+",(0,r.kt)("inlineCode",{parentName:"p"},"\u516d\u4f4d\u6578\u4e82\u78bc")),(0,r.kt)("p",null,"\u56e0\u6b64\u524d\u9762\u7684\u90e8\u4efd\u6211\u5011\u8981\u6293\u53d6\u4eca\u5929\u7684\u5e74\u4efd\u4ee5\u53ca\u6708\u4efd\uff0c\u548c\u7522\u751f\u4e00\u500b\u4f9d\u64da\u5c3e\u78bc9\u7684\u4e82\u6578\u516d\u4f4d\u6578\u5b57\u3002\n\u7576\u7136\u9019\u500b\u898f\u5247\u662f\u81ea\u5df1\u8a02\u7684\uff0c\u6709\u8208\u8da3\u7684\u4f60\u5011\u4e5f\u53ef\u4ee5\u81ea\u5df1\u7522\u751f\u60f3\u8981\u7684\u8a02\u55ae\u7de8\u865f\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'def get_rand_part_str(will_paid):\n    rand_part = 9\n    gen_digit = 6\n\n    if(will_paid):\n        while rand_part % 10 == 9:\n            rand_part = randrange(0, 10**((gen_digit-1)+1))\n    else:  \n        rand_part = randrange(0, 10**(gen_digit-1))*10 + 9  \n    return "{:000006}".format(rand_part)\n\n# \u7522\u751f\u96a8\u6a5f\u8a02\u55ae\u865f\u78bc\ndef gen_order_no(will_paid = True):\n    today = date.today()\n    year = today.year\n    month = today.month\n\n    order_no = "A{}{:02}{}".format(year, month, get_rand_part_str(will_paid))\n    return order_no\n')),(0,r.kt)("h5",{id:"\u7a0b\u5f0f\u8aaa\u660e"},"\u7a0b\u5f0f\u8aaa\u660e"),(0,r.kt)("p",null,"\u6211\u5011\u5728",(0,r.kt)("inlineCode",{parentName:"p"},"get_rand_part_str(will_paid)"),"\u4e2d\uff0c\u6703\u50b3\u5165\u662f\u5426\u6a21\u64ec\u9867\u5ba2\u4ed8\u6b3e\u7684\u5e03\u6797\u503c\uff0c\u9019\u500b\u6703\u6c7a\u5b9a\u5f8c\u9762\u8981\u4e0d\u8981\u662f\u5c3e\u65789\u3002\n\u82e5\u662f\u6703\u4ed8\u6b3e\u7684\u8a02\u55ae\uff0c\u6211\u5011\u5c31\u7522\u751f\u4e00\u500b\u81f3\u591a\u516d\u4f4d\u6578\u5b57\u7684\u4e82\u6578\uff0c\u4ee5\u4e00\u500bwhile\u8ff4\u5708\u5224\u65b7\uff0c\u5982\u679c\u62ff\u52309\u7684\u8a71\u5c31\u91cd\u7522\u751f\u4e00\u500b\uff0c\u76f4\u5230\u4e0d\u662f\u5c3e\u65789\u70ba\u6b62\u3002\u8981\u5224\u65b7\u662f\u4e0d\u662f\u5c3e\u65789\uff0c\u53ea\u9700\u8981\u5c07\u6574\u500b\u6578\u5b57\u62ff\u53bb\u6c42\u9664\u4ee510\u7684\u9918\u6578\uff0c\u5c31\u662f\u6700\u53f3\u908a\u90a3\u4f4d\u500b\u4f4d\u6578\u5b57\uff0c\u518d\u6bd4\u5c0d\u4e00\u4e0b\u5373\u53ef\u3002"),(0,r.kt)("p",null,"\u800c\u82e5\u662f\u4e0d\u6703\u4ed8\u6b3e\u7684\u8a02\u55ae\uff0c\u5c31\u53ea\u8981\u7522\u751f\u4e94\u4f4d\u6578\u5b57\u5f8c\uff0c\u4e58\u4ee510\uff0c\u6700\u5f8c\u518d\u52a0\u4e0a\u4e00\u500b9\u5373\u53ef\u3002"),(0,r.kt)("p",null,"\u9019\u6a23\u53ea\u505a\u4e86\u4e00\u534a\uff0c\u56e0\u70ba\u8981\u7dad\u63016\u4f4d\u6578\uff0c\u56e0\u6b64\u9700\u8981\u5728string format\u4e0a\u505a\u4e00\u9ede\u8a2d\u5b9a\uff0c\u5982\u6b64\u5c31\u53ef\u4ee5\u56de\u50b3\u6211\u5011\u6253\u9020\u597d\u7684\u5b8c\u7f8e\u4e82\u65786\u4f4d\u6578\u5b57\u4e32\u4e86\u3002"),(0,r.kt)("p",null,"\u800c",(0,r.kt)("inlineCode",{parentName:"p"},"gen_order_no(will_paid = True)"),"\u5c31\u662f\u6211\u5011\u8a02\u55ae\u7684\u6a21\u64ec\u7522\u751f\u5668function\uff0c\u4f7f\u7528\u6642\u50b3\u5165",(0,r.kt)("inlineCode",{parentName:"p"},"will_paid"),"\u53c3\u6578\u3002"),(0,r.kt)("p",null,"\u7acb\u523b\u4f86\u8a66\u8a66\u770b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"print(gen_order_no(True))\nprint(gen_order_no(True))\nprint(gen_order_no(True))\nprint(gen_order_no(False))\nprint(gen_order_no(False))\nprint(gen_order_no(False))\n\n# Output: A202109021960\n# Output: A202109008033\n# Output: A202109644445\n\n# \u4ee5\u4e0b\u5c3e\u6578\u90fd\u662f9\n# Output: A202109287019\n# Output: A202109048299\n# Output: A202109978419\n")),(0,r.kt)("p",null,"\u53e6\u5916\u6211\u5011\u9700\u8981\u7522\u751f\u4e00\u500b\u4ed8\u6b3e\u904e\u671f\u65e5\uff0c\u9019\u500b\u53ea\u6709\u5728\u4f7f\u7528ATM\u865b\u64ec\u5e33\u865f\u4ed8\u6b3e\u6642\u624d\u6703\u9700\u8981\uff0c\u4e14\u662f\u5fc5\u8981\u503c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'def gen_expire_date(days = 10):\n    expire_date = datetime.now() + timedelta(days=days)  \n    return expire_date.strftime("%Y%m%d")\n\nprint(gen_expire_date(10))\n# Output: 20211005    \n')),(0,r.kt)("h5",{id:"\u7a0b\u5f0f\u8aaa\u660e-1"},"\u7a0b\u5f0f\u8aaa\u660e"),(0,r.kt)("p",null,"\u5f88\u7c21\u55ae\u5c31\u662f\u4ee5\u4eca\u65e5\u52a0\u4e0a\u9700\u8981\u7684\u5929\u6578\uff0c\u518d\u4ee5",(0,r.kt)("inlineCode",{parentName:"p"},"\u5e74")," ",(0,r.kt)("inlineCode",{parentName:"p"},"\u6708")," ",(0,r.kt)("inlineCode",{parentName:"p"},"\u65e5"),"\u76f8\u9023\u7684\u65b9\u5f0f\u8f38\u51fa\uff0c\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"strftime()"),"\u4f86\u8a2d\u5b9a\u8f38\u51fa\u7684\u683c\u5f0f\u5316\u3002"),(0,r.kt)("p",null,"\u4e00\u6a23\u4f86\u8a66\u4e00\u4e0b\u52a0\u4e0a10\u5929\u5f8c\u7684\u65e5\u671f\u4f5c\u70ba\u4ed8\u6b3e\u904e\u671f\u65e5\u3002\n",(0,r.kt)("del",{parentName:"p"},"(\u9019\u9ebc\u4e45\u61c9\u8a72\u4e5f\u5fd8\u4e86\u8981\u4ed8\u9322\u4e86\u5427...)")),(0,r.kt)("p",null,"\u63a5\u8457\u6211\u5011\u5c31\u8981\u7522\u751f\u4e00\u500b",(0,r.kt)("inlineCode",{parentName:"p"},"shop_data"),"\u7684template\u4f5c\u70ba\u57fa\u790e\uff0c\u518d\u628a\u9700\u8981\u7570\u52d5\u7684\u5c6c\u6027\u91cd\u5beb\u7d66\u503c\u5c31\u597d\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# \u53d6\u5f97\u57fa\u790eshop_data template\uff0c\u4e4b\u5f8c\u518d\u4fee\u6539\u88e1\u9762\u7684\u503c\ndef gen_default_shop_data(will_paid = True, amount = 100):\n    tmp_data = {\n        "ShopNo": shop_no,\n        "OrderNo": gen_order_no(will_paid),\n        "Amount": amount * 100,\n        "CurrencyID": "TWD",\n        "PayType": "",\n        "ATMParam": { "ExpireDate": "" },\n        "CardParam": { },\n        "PrdtName": "\u865b\u64ec\u5e33\u865f\u8a02\u55ae",\n        "ReturnURL": "",\n        "BackendURL": ""\n    }\n\n    return tmp_data    \n')),(0,r.kt)("h5",{id:"\u7a0b\u5f0f\u8aaa\u660e-2"},"\u7a0b\u5f0f\u8aaa\u660e"),(0,r.kt)("p",null,"\u7531\u65bc\u500b\u53d6\u5f97\u8a02\u55ae\u7684\u6a23\u7248\u53ef\u548c\u4fe1\u7528\u5361\u4ed8\u6b3e\u7684\u5171\u7528\uff0c\u6703\u7522\u751f\u6642\u5c31\u5148\u5c07\u7121\u4ed8\u6b3e\u65b9\u5f0f\u7121\u95dc\u7684\u5fc5\u8981\u5c6c\u6027\u503c\u5728\u9019\u500b\u968e\u6bb5\u5c31\u4e5f\u4e00\u4f75\u7d66\u503c\uff0c\u4f8b\u5982",(0,r.kt)("inlineCode",{parentName:"p"},"shop_no"),"\uff0c\u548c\u53ef\u7acb\u99ac\u7522\u751f\u4e00\u500b\u8a02\u55ae\u7de8\u865f(\u547c\u53eb",(0,r.kt)("inlineCode",{parentName:"p"},"gen_order_no()"),")\u548c\u50b3\u5165\u8a02\u55ae\u7e3d\u91d1\u984d",(0,r.kt)("inlineCode",{parentName:"p"},"amount")," (\u4f9d\u898f\u5b9a\u5f8c\u9762\u88dc2\u500b\u96f6\uff0c\u56e0\u6b64\u4e58\u4ee5100)\u3002\u5f85\u53d6\u56de\u9019\u500b\u5171\u901a\u5f0f\u7684\u8a02\u55aeDictionary\u7269\u4ef6\u5f8c\uff0c\u518d\u91dd\u5c0d\u4f8b\u5982ATM\u865b\u64ec\u5e33\u6236\u4f86\u8a2d\u5b9a\u6709\u95dc\u7684\u503c\u3002"),(0,r.kt)("p",null,"\u518d\u4f86\u6211\u5011\u5c31\u8981\u628a\u4e4b\u524d\u6709\u9a57\u8b49\u904e\u7684\uff0c\u4e5f\u662f\u6700\u8907\u96dc\u7684AES-CBC\u7522\u751f",(0,r.kt)("inlineCode",{parentName:"p"},"message"),"\u5bc6\u6587\uff0c\u548c\u7522\u751f\u5b89\u5168\u7c3d\u7ae0",(0,r.kt)("inlineCode",{parentName:"p"},"sign"),"\u7684Function\u4e5f\u52a0\u4e0a\u53bb\uff0c\u76f8\u95dc\u6587\u7ae0\u8acb\u770bDay05\uff0c\u518d\u8907\u7fd2\u4e00\u4e0b\u56c9\u3002\n",(0,r.kt)("a",{parentName:"p",href:"https://ithelp.ithome.com.tw/articles/10266741"},"Day05 - [\u8c50\u6536\u6b3e] \u7e7c\u7e8c\u628a\u52a0\u5bc6\u9019\u4ef6\u4e8b\u770b\u4e0b\u53bb")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"def get_message(ori_shop_data, hash_id, iv):\n    hash_id_ba = bytearray(hash_id, 'utf-8')\n\n    iv_ba = bytearray(iv, 'utf-8')\n\n    data_string = json.dumps(ori_shop_data, ensure_ascii=False, separators=(',', ':'))\n    print(data_string)\n\n    cipher = AES.new(key=hash_id_ba, mode=AES.MODE_CBC, iv=iv_ba)\n    message = cipher.encrypt(pad(bytearray(data_string, 'utf-8'), AES.block_size))\n    return message.hex().upper()\n\ndef check_passed_rule_param(value):\n    if value is None:\n        return False\n    elif type(value) is dict or type(value) is list:\n        return False\n    elif type(value) is str and not value.strip():\n        return False\n    else:\n        return True    \n\ndef get_sign(ori_shop_data, hash_id, nonce):\n    sorted_shop_datat = {key: ori_shop_data.get(key) for key in sorted(ori_shop_data.keys(), key=str.casefold)}\n\n    removed_rule_values_shop_data = {key: value for key, value in sorted_shop_datat.items() if check_passed_rule_param(value)}\n\n    urlparam = urllib.parse.urlencode(removed_rule_values_shop_data)\n\n    urlparam_no_percent_encode = urllib.parse.unquote(urlparam).replace(\"+\", \" \")\n\n    final_shop_data = \"{}{}{}\".format(urlparam_no_percent_encode, nonce, hash_id)\n\n    sign = hashlib.sha256(final_shop_data.encode('UTF-8')).hexdigest().upper()\n    return sign\n")),(0,r.kt)("h5",{id:"\u7a0b\u5f0f\u8aaa\u660e-3"},"\u7a0b\u5f0f\u8aaa\u660e"),(0,r.kt)("p",null,"\u4e0a\u9762\u7684\u52a0\u5bc6\u8207\u5b89\u5168\u7c3d\u7ae0\u7684\u7a0b\u5f0f\u78bc\u56e0\u70ba\u4e4b\u524d\u8aaa\u660e\u904e\uff0c\u6211\u5c31\u4e0d\u518d\u8aaa\u660e\u3002"),(0,r.kt)("p",null,"\u628a\u4ee5\u4e0a\u7684function\u90fd\u6e96\u5099\u597d\u4e86\uff0c\u6211\u5011\u5c31\u53ef\u4ee5\u5be6\u969b\u7522\u751f\u4e00\u500b\u8a02\u55ae\u4e26\u9032\u884cAPI\u547c\u53eb\u4e86\uff01"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'def gen_shop_data_for_atm(will_paid, amount):\n    shop_data = gen_default_shop_data(will_paid, amount)\n\n    shop_data["PayType"] = "A"\n    shop_data["ATMParam"]["ExpireDate"] = gen_expire_date(expire_days)\n    shop_data["ReturnURL"] = return_url\n    shop_data["BackendURL"] = backend_url\n\n    return shop_data\n\ndef create_order_for_atm(nonce, will_paid, amount, expire_days, return_url, backend_url):\n    url = "https://sandbox.sinopac.com/QPay.WebAPI/api/Order"\n\n    shop_data = gen_shop_data_for_atm(will_paid, amount)\n\n    print("- shop_data: {}".format(shop_data))\n\n    msg = get_message(shop_data, hash_id, iv)\n    print("- msg: "+ msg)\n\n    sign = get_sign(shop_data, hash_id, nonce)\n    print("- sign: " + sign)   \n\n    req_param = {\n        "Version": "1.0.0",\n        "ShopNo": shop_no,\n        "APIService": "OrderCreate",\n        "Sign": sign,\n        "Nonce": nonce,\n        "Message": msg\n    }\n\n    print("-- Final request: "+ json.dumps(req_param))\n    response = requests.post(url=url, json=req_param).json()\n    return response\n')),(0,r.kt)("h5",{id:"\u7a0b\u5f0f\u8aaa\u660e-4"},"\u7a0b\u5f0f\u8aaa\u660e"),(0,r.kt)("p",null,"\u8981\u547c\u53ebAPI\u524d\uff0c\u9084\u6709\u4e00\u500b",(0,r.kt)("inlineCode",{parentName:"p"},"request"),"\u7684JSON\u683c\u5f0f\u8981\u6e96\u5099\u4e00\u4e0b\uff0c\u5c31\u548c\u6211\u5011\u6628\u5929\u6709\u6574\u7406\u7684\u5fc5\u586b\u5c6c\u6027\u7684\u8868\u683c\u662f\u4e00\u6a23\u7684\u3002\n\u6240\u4ee5\u5c31\u6109\u5feb\u7684\u628a\u7522\u751f\u597d\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"sign"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"nonce"),"\u4ee5\u53ca",(0,r.kt)("inlineCode",{parentName:"p"},"message"),"\u7684\u5167\u5bb9\u653e\u9032\u53bb\u5f8c\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"request.post()"),"\u65b9\u6cd5\u53eb\u7528API\u4e86\uff01"),(0,r.kt)("p",null,"\u8a18\u5f97\u4e0a\u9762\u9019\u500brequest\u5167\u5bb9\u8981\u653e\u5728",(0,r.kt)("inlineCode",{parentName:"p"},"json"),"\u53c3\u6578\u88e1\u9762\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# \u958b\u59cb\u5be6\u969b\u7522\u751f\u8a02\u55ae\u8207\u547c\u53eb\nhash_id = get_hash_id()\nprint("- Hash ID: " + hash_id)\n\nnonce = get_new_nonce()\nprint("- Nonce: " + nonce)  \n\niv = get_aes_iv(nonce)\nprint("- IV: " + iv)\n\nwill_paid = True\namount = 79900\nexpire_days = 10\n\n# \u5148\u66ab\u6642\u4f7f\u7528\u624b\u518a\u4e0a\u7684\uff0c\u4e4b\u5f8c\u518d\u5be6\u4f5c\u6539\u6389\nreturn_url = "http://10.11.22.113:8803/QPay.ApiClient/Store/Return"\nbackend_url = "http://10.11.22.113:8803/QPay.ApiClient/AutoPush/PushSuccess"\n\nresp = create_order_for_atm(nonce, will_paid, amount, expire_days, return_url, backend_url)\nprint("-- Response: " + str(resp))\n')),(0,r.kt)("h5",{id:"\u7a0b\u5f0f\u8aaa\u660e-5"},"\u7a0b\u5f0f\u8aaa\u660e"),(0,r.kt)("p",null,"\u9996\u5148\uff0c\u6211\u5011\u5148\u4f7f\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"gen_shop_data_for_atm(will_paid, amount)"),"\u7522\u751f\u4e00\u500b\u57fa\u790eshop_data\uff0c\u518d\u628a\u6240\u9700\u8981\u7684ATM\u76f8\u95dc\u5c6c\u6027\u503c\u586b\u5165\uff0c\u4f46RuturnURL\u4ee5\u53caBackendURL\u7684\u90e8\u4efd\u6211\u5011\u5148\u66ab\u6642\u4e0d\u5be6\u4f5c\uff0c\u5148\u7d66\u958b\u767c\u898f\u683c\u66f8\u63d0\u4f9b\u7684\u7db2\u5740\u61c9\u4ed8\u4e00\u4e0b\u3002"),(0,r.kt)("p",null,"\u6709\u4e86\u9019\u500bshop_data (\u8a0a\u606f\u5167\u6587)\u4ee5\u53cahash_id\u3001nonce\u3001iv\u7b49\uff0c\u6211\u5011\u5c31\u53ef\u4ee5\u4e00\u4f75\u628a",(0,r.kt)("inlineCode",{parentName:"p"},"message"),"\u548c",(0,r.kt)("inlineCode",{parentName:"p"},"sign"),"\u7d66\u505a\u597d\u3002\u4e0a\u9762\u7684\u7a0b\u5f0f\u78bc\u6703\u5c07\u9019\u4e9b\u503c\u5370\u51fa\u4f86\uff0c\u6211\u5011\u4e5f\u53ef\u4ee5\u518d\u6b21\u89c0\u5bdf\u4e00\u4e0b\u5167\u5bb9\u662f\u4e0d\u662f\u5982\u6211\u5011\u9810\u671f\u3002"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u70ba\u8f38\u51fa\u7d50\u679c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"#- Hash ID: 87282A2FA0E209EBE1B3713AB56A06C2\n\n#- Nonce: NjM3NjgxMDcxMzgyMDkuNTpjOTg1ZmY1M2ZjYThjOTQ0Y2E3NWJmMzJlOTk1ODNhNzQ3ODVlZjAzMzhkODEyZTdmM2NhOTBhMTFjMjA4ZjYy\n\n#- IV: BBE520650BB697E9\n\n#- shop_data: {'ShopNo': 'NA0249_001', 'OrderNo': 'A202109838256', 'Amount': 79900, 'CurrencyID': 'TWD', 'PayType': 'A', 'ATMParam': {'ExpireDate': '20211004'}, 'CardParam': {}, 'PrdtName': '\u865b\u64ec\u5e33\u865f\u8a02\u55ae', 'ReturnURL': 'http://10.11.22.113:8803/QPay.ApiClient/Store/Return', 'BackendURL': 'http://10.11.22.113:8803/QPay.ApiClient/AutoPush/PushSuccess'}\n\n#- msg: E7F53668754D7606EA864A55306D6EF7E1FB3839C5CC60D4C8E53C65247B0EF820FDCDDCCFED904026D7B2DF50DA613703D88587D58F258F7918CAAB05E031D4B88799A9C48DC82B57B546C93F62CA4C597D55033F799E93CB65D65F076D989C070C900277F53FEA778D2C81BC84FD2F3591FEF398A587C32C49F367530FC945901D69FBE120448C687799F613923B2B9593C573B5CE7B4FCD39D5AFA3A5FFAC40A7145B119C1B99C34FA7CF6BF009B39DFAD5BA5AC51D62E11923C6BA6E2CA3800FDC0F36263DC3D37262B3E6D3E3760B23F173754350C2238AF5330EB67F8CFE355A39ABA69240C925F38F6D7007158FE3E492849AFA7D8F69EDA4983CE2D33D1A38951CFACC1FABE8E0BEA1434F18A93970836DE305B576C5395D0682E73846D936EA06133A48FC19A5ACCB24F5F73EC9690A232FFD40C512089A60FD57553001B2C4D09B21549DD489A1365A471E\n\n#- sign in SHA256: B8566D3AF261827C6C5113E4D9DD7AFAFCA70D4F8196334A59E873110718176E\n\n\n#-- Final request: {\"Version\": \"1.0.0\", \"ShopNo\": \"NA0249_001\", \"APIService\": \"OrderCreate\", \"Sign\": \"B8566D3AF261827C6C5113E4D9DD7AFAFCA70D4F8196334A59E873110718176E\", \"Nonce\": \"NjM3NjgxMDcxMzgyMDkuNTpjOTg1ZmY1M2ZjYThjOTQ0Y2E3NWJmMzJlOTk1ODNhNzQ3ODVlZjAzMzhkODEyZTdmM2NhOTBhMTFjMjA4ZjYy\", \"Message\": \"E7F53668754D7606EA864A55306D6EF7E1FB3839C5CC60D4C8E53C65247B0EF820FDCDDCCFED904026D7B2DF50DA613703D88587D58F258F7918CAAB05E031D4B88799A9C48DC82B57B546C93F62CA4C597D55033F799E93CB65D65F076D989C070C900277F53FEA778D2C81BC84FD2F3591FEF398A587C32C49F367530FC945901D69FBE120448C687799F613923B2B9593C573B5CE7B4FCD39D5AFA3A5FFAC40A7145B119C1B99C34FA7CF6BF009B39DFAD5BA5AC51D62E11923C6BA6E2CA3800FDC0F36263DC3D37262B3E6D3E3760B23F173754350C2238AF5330EB67F8CFE355A39ABA69240C925F38F6D7007158FE3E492849AFA7D8F69EDA4983CE2D33D1A38951CFACC1FABE8E0BEA1434F18A93970836DE305B576C5395D0682E73846D936EA06133A48FC19A5ACCB24F5F73EC9690A232FFD40C512089A60FD57553001B2C4D09B21549DD489A1365A471E\"}\n\n\n#-- Response: {'Version': '1.0.0', 'ShopNo': 'NA0249_001', 'APIService': 'OrderCreate', 'Sign': '8A001F83ABF5EAF292119ADBFDBCFE7F34A535781E8F77A7B0D09A9FD56E90BF', 'Nonce': 'NjM3NjgxMDcxMzg2OTUuMTo4MTQwODE2NzBiMGUyYTdiNTAzZDExN2Q5NDhmOGMzMTVlZWRhOGI5ODY2OGUyOGNkMGFiM2MzZDhiNGEzZGRi', 'Message': '4AAC75A87C46EC473D94FFFB270DCAF3263CC5DB5F3E49ABCEE8E28A073F16D750469AEE4E77A1F0237DEA7043CD79273E0300D94286C81DF70B4A2C2BEA54DDA7AE4F137D109E9E6FBF4494FDCA9749C61F1DD9A30CFC7A831735D5811B26FAABC23B7C1E6CD7329974AE866EC2A72F09574E2A0C334A8F227FFF1462489E8187CCE9986940272C7B7BB1A676171F898D03909CD96EA6981B6EA7CB02003ED4DC1D95190F76DCB071E4BEDDDB55BB4D1EC7B06681D0FA583051112DDC36B1A3459A14C28789E5EBF02451EC77AC0F0DDBE00D2B07FF0D7BE195E866AF3D341CC21E8C346D2A72C4541898595F81AB60894049A32A5C551C91E4F492EF3F33F32268A8EDAB1AFBAA49F6ED1833BFD756F1955FA6BB1A3FC38773FE42E53DA5B82911073356C3A2211DE51810C5CDB54E73FFCC67BA0441BB7F53BCB4D640BD73F06336BE1FEA4A0ACFA316F07F0A5FE232380CBF245AF01777BBDF770EDD08F77F853BDC2715FDA066F271C58F31424C47B1593829E7D67A5105224AEBF10D99DB2CFC9F6483440601DAACFB20251D724DFD8447C0A28408921966A3084E97C564017973A9B8CED71F00371F391663196D8021CEF2B74C86AF0EACD275A5BFE8F2D1B787648F64EF2CCEB4CB8834B8E1'}\n")),(0,r.kt)("h3",{id:"\u6240\u4ee5\u6210\u529f\u4e86\u55ce"},"\u6240\u4ee5\uff0c\u6210\u529f\u4e86\u55ce\uff1f"),(0,r.kt)("p",null,"\u770b\u8d77\u4f86\u62ff\u5230\u4e86response\uff0c\u4e5f\u662f\u4e00\u500b\u770b\u4e0d\u61c2\u5167\u5bb9\u7684json\uff0c\u96e3\u4e0d\u6210\u662f\u6c38\u8c50API\u4e0d\u60f3\u89e3\u5bc6\u628a\u539f\u672c\u7684\u6771\u897f\u518d\u56de\u50b3\u7d66\u6211\u5011\u55ce\uff1f\u6216\u662f\u7d66\u6211\u5011\u4e00\u4e32\u4e5f\u4e0d\u60f3\u8b93\u6211\u5011\u770b\u7684\u6771\u897f\u5462\uff1f\u9019\u5c31\u662f\u50b3\u8aaa\u4e2d\u7684\u4ee5\u5176\u4eba\u4e4b\u9053\uff0c\u9084\u6cbb\u5176\u4eba\u4e4b\u8eab\u55ce\uff1f"),(0,r.kt)("p",null,"\u5176\u5be6\uff0c\u958b\u767c\u898f\u683c\u66f8\u88e1\u9762\u90fd\u6709\u5beb\u5440\uff0c\u8070\u660e\u7684\u6211\u5011(\u81ea\u5df1\u8b1b)\u61c9\u8a72\u77e5\u9053\u600e\u9ebc\u505a\u624d\u5c0d\uff0c\n\u6211\u5011\u660e\u5929\u7e7c\u7e8c\u770b\u4e0b\u53bb\u3002"))}u.isMDXComponent=!0}}]);